#!/bin/sh

mv() {
	command mv "/var/jb/MobileGoose/$1/"* "/var/jb/MobileGoose/$1/" 2> /dev/null > /dev/null || true
}

finish() {
	action="${1}"

	# No control fd: bail out
	[ -z "${action}" || -z "${CYDIA}" ] && return

	fd_version=
	fd=
	i=0
	for item in ${CYDIA}; do
		case "${i}" in
			0) fd="${item}";;
			1) fd_version="${item}";;
		esac
		i=$((i+1))
	done

	# Cydia control fd version != 1: bail out
	[ "${fd_version}" -eq 1 ] || return

	echo "finish:${action}" >&${fd}
}

case "$1" in

	triggered)
		echo "MobileGoose mods were changed, requesting a respring..."
		finish reload
		;;

	configure)
		mv Memes
		mv Notes

		rm -rf "/var/jb/MobileGoose/Memes" "/var/jb/MobileGoose/Notes" || true
		rmdir "/var/jb/MobileGoose/Mods" 2> /dev/null > /dev/null || true
		rmdir "/var/jb/MobileGoose" 2> /dev/null > /dev/null || true
		;;
		echo "     .*. ,*************************************************************  *,    "
		echo "   ..*********************************************************************,..   "
		echo "...**************************************************************************,.."
		echo " ****************************************************************************** "
		echo "********************************************************************************"
		echo "********************************************************************************"
		echo "********************************************************************************"
		echo "******************************************(%%&&%%#/*****************************"
		echo "**************************/#####/**/*(&@@@@@@@@@@@@@@&#*************************"
		echo "**********************(&@@@@@@@@@@@&@@@@@@@@@@@@@@@@@@@@&/**********************"
		echo "******************/*(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*********************"
		echo "/******************(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#*/******************"
		echo "*****************/*%@&,    *&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%********************"
		echo "/**/*************/*%@&.    ,&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*/******************"
		echo "/*******/***//***//%@@%(//#&%,  *&@@@@@@@@@@@@@@@@@@@@@@@@&*/*******************"
		echo "////////**********/#(((////*     .&@@@@@@@@@@@@@@@@@@@@@@%**********************"
		echo "//////////////*//*/((((/(///*,,,/&@@@@@@@@@@@@@@@@@@@@@%/***********************"
		echo "//////////////**/*#&#((((((((%@@@@@@@@@@@@@@@@@@@@@@&#**************************"
		echo "//////////////////#@@@&%%%%@@@@@@@@@@@@@@@@@@@@@@@&(//**************************"
		echo "//////////////////#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#(((////************************"
		echo "///////////////////%@@@@@@@@@@@@@@@@@@@@@@@@@%/*////(/(/************************"
		echo "//////////////////*#@@@@@@@@@@@@@@@@@@@@@@@#******////**************************"
		echo "////////////////////#@@@@@@@@@@@@@@@@@@@%/**************************************"
		echo "//////////////////////#@@@@@@@@@@@@@%(/*****************************************"
		echo "///////////////////////**(#%&&&%#(**********************************************"
		echo "//////////////////////////******************************/***********************"
		echo "/////////////////////////////*********************///////**/****/***************"
		echo "///////////////////////////////////*********/////////////*/*//**//**/*********/*"
		echo "///////////////////////////////////////////////////////////////*///*****/****/**"
		echo "*.////////////////////////////////////////////////////////////////*******//*//.*"
		echo " .,,/////////////////////////////////////////////////////////////////*/*****,,. "
		echo "    ,,*/////////////////////////////////////////////////////////////////*,"
		echo "Thank you for installing MobileGoose 2.1"
esac
